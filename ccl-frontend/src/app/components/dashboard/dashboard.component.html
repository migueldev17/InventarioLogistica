<h2 class="text-danger fw-bold">DASHBOARD</h2>

<h3 class="text-danger">Inventario</h3>
<table class="table table-bordered table-striped">
  <thead>
    <tr>
      <th>ID</th>
      <th>SKU</th>
      <th>Nombre</th>
      <th>Stock</th>
      <th>Stock mínimo</th>
      <th>Activo</th>
    </tr>
  </thead>
  <tbody>
    <tr *ngFor="let p of productos">
      <td>{{ p.id }}</td>
      <td>{{ p.sku }}</td>
      <td>{{ p.name }}</td>
      <td>{{ p.stock }}</td>
      <td>{{ p.minStock }}</td>
      <td>{{ p.active ? 'Sí' : 'No' }}</td>
    </tr>
  </tbody>
</table>

<h3 class="text-danger">Registrar movimiento</h3>
<form (ngSubmit)="registrarMovimiento()" class="d-flex gap-2 align-items-center">
  <label>Producto:</label>
  <select [(ngModel)]="movimiento.productId" name="productId" required>
    <option *ngFor="let p of productos" [value]="p.id">{{ p.name }}</option>
  </select>

  <label>Cantidad:</label>
  <input type="number" [(ngModel)]="movimiento.cantidad" name="cantidad" required />

  <label>Tipo:</label>
  <select [(ngModel)]="movimiento.type" name="type" required>
    <option value="IN">Entrada</option>
    <option value="OUT">Salida</option>
  </select>

  <button type="submit" class="btn btn-danger">Registrar</button>
</form>

<div *ngIf="mensaje" class="alert alert-info mt-3">{{ mensaje }}</div>

<!-- Mostrar info del usuario -->
<div class="alert alert-primary mt-3">
  Usuario actual: {{ currentUser }} - Rol: {{ role }}
</div>

<!-- Solo se muestra si el rol es admin -->
<div *ngIf="role?.toLowerCase() === 'admin'">
  <h3 class="text-danger mt-4">Historial de Movimientos</h3>
  <table class="table table-striped">
    <thead>
      <tr>
        <th>ID</th>
        <th>Producto</th>
        <th>Cantidad</th>
        <th>Tipo</th>
        <th>Usuario</th>
        <th>Fecha</th>
        <th>Nota</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let m of movimientos">
        <td>{{ m.id }}</td>
        <td>{{ m.producto }}</td>
        <td>{{ m.quantity }}</td>
        <td>{{ m.type }}</td>
        <td>{{ m.usuario }}</td>
        <td>{{ m.timestamp | date:'short' }}</td>
        <td>{{ m.note }}</td>
      </tr>
    </tbody>
  </table>
</div>
